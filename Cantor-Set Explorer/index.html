<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cantor-Set Explorer</title>
<style>
  /* ===== Layout & basics ===== */
  body            {font-family:system-ui,sans-serif;margin:20px;background:#fff;color:#000;}
  h1              {margin-top:0;}
  #main           {display:flex;gap:20px;align-items:flex-start;}
  canvas          {border:1px solid #ccc;}
  #controls       {display:flex;flex-direction:column;gap:12px;margin-top:20px;}
  .ctrl-group     {display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
  input[type=range]{width:220px;}
  button,label    {cursor:pointer;}
  #data-panel     {min-width:200px;}
  #data-panel p   {margin:4px 0;}
</style>
</head>
<body>

<h1>Cantor-Set Explorer</h1>

<!-- ===== Visual & data ===== -->
<div id="main">
  <canvas id="cantorCanvas" width="900" height="500"></canvas>

  <div id="data-panel">
    <h3>Live data</h3>
    <p id="depthDisplay"></p>
    <p id="segmentsDisplay"></p>
    <p id="lengthDisplay"></p>
    <p>Hausdorff dim ≈ 0.6309</p>
  </div>
</div>

<!-- ===== Controls ===== -->
<div id="controls">
  <div class="ctrl-group">
    <label for="depthRange">Depth</label>
    <input type="range" id="depthRange" min="0" max="8" step="1" value="5">
    <span id="depthLabel">5</span>
  </div>

  <div class="ctrl-group">
    <button id="animateBtn">Animate</button>
    <label><input type="checkbox" id="randomColours"> Random colours</label>
  </div>

  <button id="downloadBtn">Download PNG</button>
</div>

<script>
/* =========================================
   Cantor-Set Explorer – single-file app
   ========================================= */

/* ---------- Canvas & context ---------- */
const canvas = document.getElementById('cantorCanvas');
const ctx    = canvas.getContext('2d');

/* ---------- UI elements ---------- */
const depthRange   = document.getElementById('depthRange');
const depthLabel   = document.getElementById('depthLabel');
const depthDisplay = document.getElementById('depthDisplay');
const segmentsDisp = document.getElementById('segmentsDisplay');
const lengthDisp   = document.getElementById('lengthDisplay');
const animateBtn   = document.getElementById('animateBtn');
const randomColours= document.getElementById('randomColours');
const downloadBtn  = document.getElementById('downloadBtn');

/* ---------- State ---------- */
let animTimer = null;   // interval id
let dir       = 1;      // ping-pong direction

/* ---------- Utility: pastel colour ---------- */
const pastel = () => {
  const h = Math.floor(Math.random()*360);
  return `hsl(${h}, 60%, 70%)`;
};

/* ---------- Build levels for classic ratio 1/3 ---------- */
function buildLevels(depth){
  const levels = [];
  const gaps   = [];

  let current = [[0,1]];
  for(let d=0; d<=depth; d++){
    levels.push(current.map(s=>s.slice()));       // clone
    if(d===depth) break;

    const next = [];
    const gNow = [];
    current.forEach(([s,e])=>{
      const len = e-s;
      const gS  = s + len/3;
      const gE  = e - len/3;
      next.push([s,gS], [gE,e]);
      gNow.push([gS,gE]);
    });
    gaps.push(gNow);
    current = next;
  }
  return {levels,gaps};
}

/* ---------- Drawing ---------- */
function draw(){
  const depth = +depthRange.value;
  const useColours = randomColours.checked;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const {levels,gaps} = buildLevels(depth);
  const rowH = canvas.height / (depth+1);

  levels.forEach((segments,lvl)=>{
    const y = lvl * rowH + rowH*0.1;
    const h = rowH*0.8;

    ctx.fillStyle = useColours ? pastel() : '#000';
    segments.forEach(([s,e])=>{
      const x = s*canvas.width;
      const w = (e-s)*canvas.width;
      ctx.fillRect(x,y,w,h);
    });

    /* faint outlines of removed gaps */
    if(lvl<depth){
      ctx.strokeStyle = 'rgba(0,0,0,0.25)';
      gaps[lvl].forEach(([s,e])=>{
        const x = s*canvas.width;
        const w = (e-s)*canvas.width;
        ctx.strokeRect(x,y,w,h);
      });
    }
  });
}

/* ---------- Data panel ---------- */
function updateData(){
  const n = +depthRange.value;
  depthLabel.textContent   = n;
  depthDisplay.textContent = `Depth n = ${n}`;
  segmentsDisp.textContent = `Segments: 2ⁿ = ${(2**n).toLocaleString()}`;
  lengthDisp.textContent   = `Total length: ${(Math.pow(2/3,n)).toFixed(5)}`;
}

/* ---------- Refresh ---------- */
function refresh(){ updateData(); draw(); }

/* ---------- Animation ---------- */
function startAnim(){
  animateBtn.textContent='Stop';
  animTimer=setInterval(()=>{
    let d=+depthRange.value;
    if(d>=+depthRange.max) dir=-1;
    if(d<=+depthRange.min) dir=1;
    depthRange.value=d+dir;
    refresh();
  },600);
}
function stopAnim(){ clearInterval(animTimer); animTimer=null; animateBtn.textContent='Animate'; }

/* ---------- Event wiring ---------- */
depthRange.addEventListener('input',()=>{stopAnim(); refresh();});
randomColours.addEventListener('change',refresh);
animateBtn.addEventListener('click',()=>{animTimer?stopAnim():startAnim();});
downloadBtn.addEventListener('click',()=>{
  const a=document.createElement('a');
  a.download='cantor.png';
  a.href=canvas.toDataURL('image/png');
  a.click();
});

/* ---------- Initial paint ---------- */
refresh();
</script>
</body>
</html>
