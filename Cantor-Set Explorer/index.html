<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cantor-Set Explorer</title>
<style>
  /* ===== Layout & basics ===== */
  body            {font-family:system-ui,sans-serif;margin:20px;background:#fff;color:#000;}
  h1              {margin-top:0;}
  #main           {display:flex;gap:20px;align-items:flex-start;}
  canvas          {border:1px solid #ccc;}
  #controls       {display:flex;flex-direction:column;gap:12px;margin-top:20px;}
  .ctrl-group     {display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
  input[type=range]{width:220px;}
  button,label    {cursor:pointer;}
  #data-panel     {min-width:200px;}
  #data-panel p   {margin:4px 0;}
</style>
</head>
<body>

<h1>Cantor-Set Explorer</h1>
  <!-- Add inside <body> just below the existing <h1> -->
<div class='tab-buttons'>
  <button id='explorerTabBtn' class='active'>Set Explorer</button>
  <button id='dimensionTabBtn'>Box Dimension</button>
</div>

<!-- Existing explorer markup REMAINS THE SAME -->

<!-- === NEW Dimension Tab === -->
<div id='dimensionTab' style='display:none;'>
  <canvas id='dimensionCanvas' width='900' height='100'></canvas>

  <div id='dimensionControls'>
    <label>k (box size = 3^-k)
      <input type='range' id='boxExpRange' min='0' max='8' step='1' value='0'>
      <span id='boxExpLabel'>0</span>
    </label>
    <p id='boxSizeDisplay'></p>
    <p id='occupiedDisplay'></p>
    <button id='addDataBtn'>Add data row</button>
    <button id='plotBtn'>Plot log‑log</button>
  </div>

  <table id='dataTable'>
    <thead><tr><th>k</th><th>Box size</th><th>Occupied boxes</th></tr></thead>
    <tbody></tbody>
  </table>

  <canvas id='chartCanvas' width='600' height='400'></canvas>
</div>

<!-- === SCRIPT additions (put after existing script) === -->
<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<script>
// tab switching
const explorerTabBtn=document.getElementById('explorerTabBtn');
const dimensionTabBtn=document.getElementById('dimensionTabBtn');
const dimensionTab=document.getElementById('dimensionTab');

explorerTabBtn.addEventListener('click',()=>{dimensionTab.style.display='none';});
dimensionTabBtn.addEventListener('click',()=>{dimensionTab.style.display='block';});

// box‑dimension logic (reuses buildLevels from original)
const boxExpRange=document.getElementById('boxExpRange');
const boxExpLabel=document.getElementById('boxExpLabel');
const boxSizeDisp=document.getElementById('boxSizeDisplay');
const occupiedDisp=document.getElementById('occupiedDisplay');
const addDataBtn=document.getElementById('addDataBtn');
const plotBtn=document.getElementById('plotBtn');
const tableBody=document.getElementById('dataTable').querySelector('tbody');
const chartCanvas=document.getElementById('chartCanvas');
let dataPoints=[],chart;

function countOccupied(k){
  const depth=+depthRange.value;
  const segments=buildLevels(depth).levels[depth];
  const size=Math.pow(3,-k);
  const n=Math.ceil(1/size);
  let occ=0;
  for(let i=0;i<n;i++){
    const a=i*size,b=(i+1)*size;
    if(segments.some(([s,e])=>!(e<=a||s>=b))) occ++;
  }
  return {size,occ};
}
function updateBoxInfo(){
  const k=+boxExpRange.value;
  const {size,occ}=countOccupied(k);
  boxExpLabel.textContent=k;
  boxSizeDisp.textContent=`s = ${size.toFixed(5)}`;
  occupiedDisp.textContent=`N(s) = ${occ}`;
}
boxExpRange.addEventListener('input',updateBoxInfo);

addDataBtn.addEventListener('click',()=>{
  const k=+boxExpRange.value;
  const {size,occ}=countOccupied(k);
  dataPoints.push({k,size,occ});
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${k}</td><td>${size.toExponential(3)}</td><td>${occ}</td>`;
  tableBody.appendChild(tr);
});
plotBtn.addEventListener('click',()=>{
  if(dataPoints.length<2){alert('Need >=2 points');return;}
  const pts=dataPoints.map(p=>({x:Math.log10(1/p.size),y:Math.log10(p.occ)}));
  if(chart) chart.destroy();
  chart=new Chart(chartCanvas,{type:'scatter',data:{datasets:[{data:pts}]},options:{responsive:false}});
});
updateBoxInfo();
</script>

<!-- ===== Visual & data ===== -->
<div id="main">
  <canvas id="cantorCanvas" width="900" height="500"></canvas>

  <div id="data-panel">
    <h3>Live data</h3>
    <p id="depthDisplay"></p>
    <p id="segmentsDisplay"></p>
    <p id="lengthDisplay"></p>
    <p>Hausdorff dim ≈ 0.6309</p>
  </div>
</div>

<!-- ===== Controls ===== -->
<div id="controls">
  <div class="ctrl-group">
    <label for="depthRange">Depth</label>
    <input type="range" id="depthRange" min="0" max="8" step="1" value="5">
    <span id="depthLabel">5</span>
  </div>

  <div class="ctrl-group">
    <button id="animateBtn">Animate</button>
    <label><input type="checkbox" id="randomColours"> Random colours</label>
  </div>

  <button id="downloadBtn">Download PNG</button>
</div>

<script>
/* =========================================
   Cantor-Set Explorer – single-file app
   ========================================= */

/* ---------- Canvas & context ---------- */
const canvas = document.getElementById('cantorCanvas');
const ctx    = canvas.getContext('2d');

/* ---------- UI elements ---------- */
const depthRange   = document.getElementById('depthRange');
const depthLabel   = document.getElementById('depthLabel');
const depthDisplay = document.getElementById('depthDisplay');
const segmentsDisp = document.getElementById('segmentsDisplay');
const lengthDisp   = document.getElementById('lengthDisplay');
const animateBtn   = document.getElementById('animateBtn');
const randomColours= document.getElementById('randomColours');
const downloadBtn  = document.getElementById('downloadBtn');

/* ---------- State ---------- */
let animTimer = null;   // interval id
let dir       = 1;      // ping-pong direction

/* ---------- Utility: pastel colour ---------- */
const pastel = () => {
  const h = Math.floor(Math.random()*360);
  return `hsl(${h}, 60%, 70%)`;
};

/* ---------- Build levels for classic ratio 1/3 ---------- */
function buildLevels(depth){
  const levels = [];
  const gaps   = [];

  let current = [[0,1]];
  for(let d=0; d<=depth; d++){
    levels.push(current.map(s=>s.slice()));       // clone
    if(d===depth) break;

    const next = [];
    const gNow = [];
    current.forEach(([s,e])=>{
      const len = e-s;
      const gS  = s + len/3;
      const gE  = e - len/3;
      next.push([s,gS], [gE,e]);
      gNow.push([gS,gE]);
    });
    gaps.push(gNow);
    current = next;
  }
  return {levels,gaps};
}

/* ---------- Drawing ---------- */
function draw(){
  const depth = +depthRange.value;
  const useColours = randomColours.checked;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const {levels,gaps} = buildLevels(depth);
  const rowH = canvas.height / (depth+1);

  levels.forEach((segments,lvl)=>{
    const y = lvl * rowH + rowH*0.1;
    const h = rowH*0.8;

    ctx.fillStyle = useColours ? pastel() : '#000';
    segments.forEach(([s,e])=>{
      const x = s*canvas.width;
      const w = (e-s)*canvas.width;
      ctx.fillRect(x,y,w,h);
    });

    /* faint outlines of removed gaps */
    if(lvl<depth){
      ctx.strokeStyle = 'rgba(0,0,0,0.25)';
      gaps[lvl].forEach(([s,e])=>{
        const x = s*canvas.width;
        const w = (e-s)*canvas.width;
        ctx.strokeRect(x,y,w,h);
      });
    }
  });
}

/* ---------- Data panel ---------- */
function updateData(){
  const n = +depthRange.value;
  depthLabel.textContent   = n;
  depthDisplay.textContent = `Depth n = ${n}`;
  segmentsDisp.textContent = `Segments: 2ⁿ = ${(2**n).toLocaleString()}`;
  lengthDisp.textContent   = `Total length: ${(Math.pow(2/3,n)).toFixed(5)}`;
}

/* ---------- Refresh ---------- */
function refresh(){ updateData(); draw(); }

/* ---------- Animation ---------- */
function startAnim(){
  animateBtn.textContent='Stop';
  animTimer=setInterval(()=>{
    let d=+depthRange.value;
    if(d>=+depthRange.max) dir=-1;
    if(d<=+depthRange.min) dir=1;
    depthRange.value=d+dir;
    refresh();
  },600);
}
function stopAnim(){ clearInterval(animTimer); animTimer=null; animateBtn.textContent='Animate'; }

/* ---------- Event wiring ---------- */
depthRange.addEventListener('input',()=>{stopAnim(); refresh();});
randomColours.addEventListener('change',refresh);
animateBtn.addEventListener('click',()=>{animTimer?stopAnim():startAnim();});
downloadBtn.addEventListener('click',()=>{
  const a=document.createElement('a');
  a.download='cantor.png';
  a.href=canvas.toDataURL('image/png');
  a.click();
});

/* ---------- Initial paint ---------- */
refresh();
</script>
</body>
</html>
