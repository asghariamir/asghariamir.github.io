<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="logo-mathswell-square-mirror.ico" type="image/x-icon">
<link rel="icon" href="logo-mathswell-square-mirror.svg" type="image/svg+xml">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absolute Value Explorer</title>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.26.0/plotly.min.js"></script>
    <style>
        :root {
            --brand: #0f766e;
            --brand-light: #10b981;
            --primary-color: #1565c0;
            --secondary-color: #c62828;
            --accent: #f59e0b;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #424242;
            --text-color: #212121;
            --success-color: #4caf50;
            --bg: #f7faf9;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            line-height: 1.6; 
            background-color: var(--bg); 
            color: var(--text-color); 
            display: flex; 
            justify-content: center; 
            padding: 1rem; 
        }
        
        .container { 
            width: 100%; 
            max-width: 1000px; 
            margin: 0 auto; 
            background-color: white; 
            box-shadow: 0 4px 16px rgba(0,0,0,0.1); 
            border-radius: 12px; 
            overflow: hidden; 
        }
        
        h2 { 
            font-size: 2.2rem; 
            color: var(--brand); 
            margin: 1.5rem 0 0.5rem; 
            text-align: center; 
        }
        
        p.info { 
            color: #4b5563; 
            margin-bottom: 1.5rem; 
            text-align: center; 
            padding: 0 1rem;
        }

        /* Tabs - following circle app style */
        .tabs { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 0.5rem; 
            margin-bottom: 2rem; 
            border-bottom: 2px solid var(--medium-gray); 
            padding: 0 1rem;
        }
        
        .tab-button { 
            padding: 0.75rem 1.5rem; 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-size: 1.1rem;
            color: var(--dark-gray); 
            transition: all 0.3s ease; 
            border-bottom: 4px solid transparent; 
            transform: translateY(2px);
        }
        
        .tab-button.active { 
            color: var(--brand); 
            border-bottom-color: var(--brand); 
        }
        
        .tab-content { 
            display: none; 
            padding: 1.5rem; 
        }
        
        .tab-content.active { 
            display: block; 
        }

        /* Controls */
        .controls { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 1rem 1.5rem; 
            padding: 1rem; 
            background-color: #e6fffb; 
            border-radius: 8px; 
            margin-bottom: 1.5rem; 
            border: 1px solid #d1fae5;
        }
        
        .control-group { 
            display: flex; 
            flex-direction: column; 
            gap: 0.5rem; 
        }
        
        .full-width { 
            grid-column: 1 / -1; 
        }
        
        .param-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 1rem; 
        }

        label { 
            font-size: 0.9rem; 
            font-weight: 600; 
            color: #4b5563; 
        }
        
        input[type="range"] { 
            width: 100%; 
            cursor: pointer;
        }
        
        input[type="number"], input[type="text"], select { 
            border: 2px solid var(--medium-gray); 
            border-radius: 4px; 
            padding: 10px; 
            font-size: 1rem; 
            width: 100%;
            transition: border-color 0.2s ease;
        }
        
        input[type="text"] { 
            font-family: monospace; 
        }
        
        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1);
        }
        
        output { 
            font-weight: bold; 
            color: var(--brand); 
            background: rgba(15, 118, 110, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-align: center;
        }

        .plot-container { 
            width: 100%; 
            height: 400px; 
            border: 1px solid var(--medium-gray); 
            border-radius: 8px; 
            overflow: hidden;
        }

        .equation-display { 
            margin-top: 1.5rem; 
            padding: 1rem; 
            background: linear-gradient(165deg, #e6fffb 0%, #fdfcf7 25%, rgba(245, 158, 11, 0.05) 100%);
            border-radius: 8px; 
            border-left: 4px solid var(--brand);
        }
        
        .equation-display p { 
            margin: 0.5rem 0; 
            font-family: monospace; 
            font-size: 1.1rem; 
            text-align: center; 
        }
        
        .equation-display strong { 
            color: var(--brand); 
        }

        /* Special features section */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .feature-btn {
            padding: 0.5rem;
            background: white;
            color: var(--dark-gray);
            border: 2px solid var(--medium-gray);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.15s ease;
        }

        .feature-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .feature-btn.active {
            background: var(--brand);
            color: white;
            border-color: var(--brand);
        }

        /* Number Line Specific */
        #number-line-canvas {
            height: 150px;
            display: block;
            margin: 0 auto;
            width: 100%;
        }

        /* Introduction tab styles */
        .intro-section {
            margin: 2rem 0;
        }

        .intro-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid var(--brand);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .intro-box h3 {
            color: var(--brand);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .intro-box p {
            margin-bottom: 0.8rem;
            line-height: 1.7;
            color: #4b5563;
        }

        .intro-box strong {
            color: var(--brand);
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .concept-card {
            background: white;
            border: 2px solid #e6fffb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: var(--brand);
        }

        .concept-card h4 {
            color: var(--brand);
            margin-bottom: 0.5rem;
        }

        .concept-card .math {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin: 0.5rem 0;
        }

        .interactive-demo {
            background: #e6fffb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .demo-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
        }

        .demo-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--brand);
            min-width: 60px;
            text-align: center;
        }

        #intro-canvas {
            width: 100%;
            height: 200px;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            background: white;
        }

        .try-button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--brand), var(--brand-light));
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }

        .try-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }
        .mathswell-nav {
            display: flex;
            justify-content: center;
            margin: 0.75rem 0 1rem;
            position: relative;
            z-index: 1001;
        }
        
        .mathswell-nav .mw-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-weight: 800;
            font-size: 1.05rem;
            color: var(--brand);
            padding: 0.4rem 0.8rem;
            border-radius: 999px;
            background: #fff;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }
        
        .mathswell-nav .mw-link img {
            display: block;
        }

        /* Preset examples */
        .preset-pills {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .preset-pill {
            padding: 0.4rem 0.8rem;
            background: linear-gradient(135deg, #e6fffb, #f0fdf4);
            color: var(--brand);
            border: 1px solid #bdebe3;
            border-radius: 999px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .preset-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(15, 118, 110, 0.2);
        }

        /* Info pills */
        .info-pills {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            padding: 0.5rem 0;
        }

        .info-pill {
            padding: 0.25rem 0.5rem;
            background: rgba(15, 118, 110, 0.1);
            color: var(--brand);
            border-radius: 4px;
            font-size: 0.85rem;
        }
    </style>
</head>

<body>
<div class="container">
    <h2>Absolute Value Explorer</h2>
    
  <div class="mathswell-nav">
    <a href="." class="mw-link">
        <img src="logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28">
        <span>MATHSWELL</span>
    </a>
</div>
    <p class="info">Explore absolute values from two perspectives: as a function on a 2D graph, and as distance on a number line.</p>

    <div class="tabs">
        <button class="tab-button active" data-tab="introduction">Introduction</button>
        <button class="tab-button" data-tab="functions">Absolute Value Functions</button>
        <button class="tab-button" data-tab="inequalities">Absolute Value Inequalities</button>
    </div>

    <section id="introduction-tab" class="tab-content active">
        <div class="intro-section">
            <div class="intro-box">
                <h3>📐 What is Absolute Value?</h3>
                <p>The <strong>absolute value</strong> of a number is its distance from zero on the number line, regardless of direction.</p>
                <p>We write it using vertical bars: |x|</p>
                <p>For example: |5| = 5 and |-5| = 5, because both 5 and -5 are 5 units away from zero.</p>
            </div>

            <div class="concept-grid">
                <div class="concept-card">
                    <h4>Definition</h4>
                    <div class="math">|x| = x if x ≥ 0</div>
                    <div class="math">|x| = -x if x < 0</div>
                    <p>Always gives a non-negative result</p>
                </div>
                <div class="concept-card">
                    <h4>Geometric Meaning</h4>
                    <div class="math">|x - a|</div>
                    <p>Distance between x and a on the number line</p>
                </div>
                <div class="concept-card">
                    <h4>Key Property</h4>
                    <div class="math">|ab| = |a| × |b|</div>
                    <p>Absolute value of a product equals product of absolute values</p>
                </div>
            </div>

            <div class="interactive-demo">
                <h3 style="text-align: center; color: var(--brand); margin-bottom: 1rem;">🎮 Interactive Demo: Explore |x|</h3>
                <div class="demo-controls">
                    <label>Move x:</label>
                    <input type="range" id="intro-slider" min="-10" max="10" step="0.5" value="0">
                    <div class="demo-value" id="x-value">0</div>
                    <div style="margin: 0 1rem;">→</div>
                    <label>|x| =</label>
                    <div class="demo-value" id="abs-value">0</div>
                </div>
                <canvas id="intro-canvas"></canvas>
            </div>

            <div class="intro-box">
                <h3>🎯 Two Perspectives</h3>
                <p><strong>1. As a Function:</strong> The graph y = |x| creates a V-shape, showing how the output changes with input.</p>
                <p><strong>2. As Distance:</strong> On a number line, |x - a| < k means "all points within k units of a".</p>
                <p>This app lets you explore both perspectives interactively!</p>
            </div>

            <div style="text-align: center; margin: 2rem 0;">
                <button class="try-button" onclick="switchToFunctions()">Try Functions →</button>
                <button class="try-button" onclick="switchToInequalities()">Try Inequalities →</button>
            </div>
        </div>
    </section>

    <section id="functions-tab" class="tab-content">
        <div class="preset-pills">
            <button class="preset-pill" data-preset="v-shape">Classic V</button>
            <button class="preset-pill" data-preset="w-shape">W Shape</button>
            <button class="preset-pill" data-preset="shifted">Shifted</button>
            <button class="preset-pill" data-preset="complex">Complex</button>
            <button class="preset-pill" data-preset="reset" style="background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; border-color: #ff6b6b;">Reset</button>
        </div>

        <div class="controls">
            <div class="param-row full-width">
                <div class="control-group">
                    <label for="a-slider">Vertical stretch (a):</label>
                    <input type="range" id="a-slider" min="-2" max="2" step="0.1" value="1">
                    <output id="a-value">1.0</output>
                </div>
                <div class="control-group">
                    <label for="b-slider">Horizontal shift 1 (b):</label>
                    <input type="range" id="b-slider" min="-5" max="5" step="0.1" value="0">
                    <output id="b-value">0.0</output>
                </div>
            </div>
            <div class="param-row full-width">
                <div class="control-group">
                    <label for="c-slider">Second stretch (c):</label>
                    <input type="range" id="c-slider" min="-2" max="2" step="0.1" value="0">
                    <output id="c-value">0.0</output>
                </div>
                <div class="control-group">
                    <label for="d-slider">Horizontal shift 2 (d):</label>
                    <input type="range" id="d-slider" min="-5" max="5" step="0.1" value="0">
                    <output id="d-value">0.0</output>
                </div>
            </div>
        </div>

        <div class="features-grid">
            <button class="feature-btn" id="show-vertex">Show Vertex</button>
            <button class="feature-btn" id="show-intercepts">Show Intercepts</button>
            <button class="feature-btn" id="show-trace">Trace Points</button>
            <button class="feature-btn" id="show-transformations">Transformations</button>
            <button class="feature-btn" id="auto-fit" style="background: #e6fffb; border-color: var(--brand);">Auto Fit</button>
            <button class="feature-btn" id="reset-view" style="background: #fef3c7; border-color: #f59e0b;">Reset View</button>
        </div>

        <div class="equation-display" id="function-equation-display"></div>
        <div class="plot-container" id="function-plot"></div>
        
        <div class="info-pills" id="function-info"></div>
    </section>

    <section id="inequalities-tab" class="tab-content">
        <p class="info">Define an inequality using symbols. See how the visual representation on the number line and the interval notation are linked!</p>
        
        <div class="preset-pills">
            <button class="preset-pill" data-ineq="|x-3|<5">Near 3</button>
            <button class="preset-pill" data-ineq="|x+2|<=4">Within 4 of -2</button>
            <button class="preset-pill" data-ineq="|x|>7">Far from 0</button>
            <button class="preset-pill" data-ineq="|x-5|>=3">Away from 5</button>
        </div>

        <div class="controls">
            <div class="control-group full-width">
                <label for="inequality-input">Enter Inequality (e.g., |x-3| < 5):</label>
                <input type="text" id="inequality-input" value="|x-0|<5" placeholder="|x-a| < k">
            </div>
        </div>
        
        <div class="plot-container" style="height: 150px;">
            <canvas id="number-line-canvas"></canvas>
        </div>
        
        <div class="equation-display" id="inequality-output-display"></div>
    </section>
</div>

<script>
// Simple initialization without complex checks
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        initApp();
    }, 100);
});

function initApp() {
    // --- GLOBAL CONFIG ---
    const PLOT_RANGE_X = [-10, 10];
    const PLOT_RANGE_Y = [-10, 10];
    const NUMBER_LINE_RANGE = [-25, 25];

    // --- STATE ---
    let state = {
        currentTab: 'introduction',
        functions: { a: 1, b: 0, c: 0, d: 0 },
        inequalities: { a: 0, k: 5, operator: '<' },
        features: {
            vertex: false,
            intercepts: false,
            trace: false,
            transformations: false
        },
        tracePoints: []
    };

    // --- DOM ELEMENTS ---
    const introSlider = document.getElementById('intro-slider');
    const xValueDisplay = document.getElementById('x-value');
    const absValueDisplay = document.getElementById('abs-value');
    const introCanvas = document.getElementById('intro-canvas');
    const introCtx = introCanvas.getContext('2d');
    const aSlider = document.getElementById('a-slider');
    const bSlider = document.getElementById('b-slider');
    const cSlider = document.getElementById('c-slider');
    const dSlider = document.getElementById('d-slider');
    const aValue = document.getElementById('a-value');
    const bValue = document.getElementById('b-value');
    const cValue = document.getElementById('c-value');
    const dValue = document.getElementById('d-value');
    const functionPlot = document.getElementById('function-plot');
    const functionEquation = document.getElementById('function-equation-display');
    const functionInfo = document.getElementById('function-info');
    const inequalityInput = document.getElementById('inequality-input');
    const canvas = document.getElementById('number-line-canvas');
    const ctx = canvas.getContext('2d');
    const inequalityOutput = document.getElementById('inequality-output-display');

    // --- INITIALIZATION ---
    function init() {
        // Tab switching
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        // Sliders
        [aSlider, bSlider, cSlider, dSlider].forEach(slider => {
            slider.addEventListener('input', updateFunction);
        });

        // Features
        document.querySelectorAll('.feature-btn').forEach(btn => {
            btn.addEventListener('click', () => toggleFeature(btn.id));
        });

        // Presets
        document.querySelectorAll('.preset-pill').forEach(pill => {
            pill.addEventListener('click', () => {
                if (pill.dataset.preset) applyPreset(pill.dataset.preset);
                if (pill.dataset.ineq) {
                    inequalityInput.value = pill.dataset.ineq;
                    updateInequality();
                }
            });
        });

        // Inequality input
        inequalityInput.addEventListener('input', updateInequality);

        // Introduction tab demo
        introSlider.addEventListener('input', updateIntroDemo);

        // Initial render
        updateIntroDemo();
        switchTab('introduction');
    }

    // --- INTRODUCTION TAB ---
    function updateIntroDemo() {
        const x = parseFloat(introSlider.value);
        const absX = Math.abs(x);
        
        xValueDisplay.textContent = x.toFixed(1);
        absValueDisplay.textContent = absX.toFixed(1);
        
        // Draw on canvas
        introCanvas.width = introCanvas.clientWidth;
        introCanvas.height = introCanvas.clientHeight;
        
        const w = introCanvas.width;
        const h = introCanvas.height;
        const centerX = w / 2;
        const centerY = h / 2;
        const scale = w / 25;
        
        introCtx.clearRect(0, 0, w, h);
        
        // Draw grid
        introCtx.strokeStyle = '#e0e0e0';
        introCtx.lineWidth = 1;
        for (let i = -10; i <= 10; i += 5) {
            const xPos = centerX + i * scale;
            introCtx.beginPath();
            introCtx.moveTo(xPos, 0);
            introCtx.lineTo(xPos, h);
            introCtx.stroke();
        }
        
        // Draw number line
        introCtx.strokeStyle = '#333';
        introCtx.lineWidth = 2;
        introCtx.beginPath();
        introCtx.moveTo(0, centerY);
        introCtx.lineTo(w, centerY);
        introCtx.stroke();
        
        // Draw zero
        introCtx.fillStyle = '#666';
        introCtx.font = '14px sans-serif';
        introCtx.textAlign = 'center';
        introCtx.fillText('0', centerX, centerY + 20);
        
        // Draw the distance visualization
        if (x !== 0) {
            // Draw arc showing distance
            introCtx.strokeStyle = 'rgba(15, 118, 110, 0.3)';
            introCtx.lineWidth = 40;
            introCtx.beginPath();
            introCtx.moveTo(centerX, centerY);
            introCtx.lineTo(centerX + x * scale, centerY);
            introCtx.stroke();
            
            // Draw distance label
            introCtx.fillStyle = 'var(--brand)';
            introCtx.font = 'bold 16px sans-serif';
            introCtx.fillText(`|${x.toFixed(1)}| = ${absX.toFixed(1)}`, centerX + (x * scale) / 2, centerY - 30);
        }
        
        // Draw points
        // Zero point
        introCtx.fillStyle = '#666';
        introCtx.beginPath();
        introCtx.arc(centerX, centerY, 5, 0, 2 * Math.PI);
        introCtx.fill();
        
        // X point
        introCtx.fillStyle = x < 0 ? '#c62828' : '#0f766e';
        introCtx.beginPath();
        introCtx.arc(centerX + x * scale, centerY, 8, 0, 2 * Math.PI);
        introCtx.fill();
        
        // Draw x value
        introCtx.fillStyle = '#333';
        introCtx.font = 'bold 14px sans-serif';
        introCtx.fillText(x.toFixed(1), centerX + x * scale, centerY + 35);
    }

    // Quick navigation functions
    window.switchToFunctions = function() {
        switchTab('functions');
    };
    
    window.switchToInequalities = function() {
        switchTab('inequalities');
    };

    // --- TAB SWITCHING ---
    function switchTab(tab) {
        state.currentTab = tab;
        
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.tab === tab);
        });
        
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.toggle('active', content.id === `${tab}-tab`);
        });

        if (tab === 'functions') updateFunction();
        else updateInequality();
    }

    // --- PRESETS ---
    function applyPreset(preset) {
        const presets = {
            'v-shape': { a: 1, b: 0, c: 0, d: 0 },
            'w-shape': { a: 1, b: -3, c: 1, d: 3 },
            'shifted': { a: 2, b: 2, c: -1, d: -2 },
            'complex': { a: 1.5, b: -4, c: -1.5, d: 4 },
            'reset': { a: 1, b: 0, c: 0, d: 0 }
        };

        if (presets[preset]) {
            const p = presets[preset];
            aSlider.value = p.a;
            bSlider.value = p.b;
            cSlider.value = p.c;
            dSlider.value = p.d;
            updateFunction();
        }
    }

    // --- FEATURES ---
    function toggleFeature(id) {
        if (id === 'auto-fit') {
            autoFitGraph();
            return;
        }
        
        if (id === 'reset-view') {
            resetView();
            return;
        }
        
        const key = id.replace('show-', '');
        state.features[key] = !state.features[key];
        document.getElementById(id).classList.toggle('active', state.features[key]);
        
        if (key === 'trace' && !state.features.trace) {
            state.tracePoints = [];
        }
        
        updateFunction();
    }

    // --- AUTO FIT AND RESET ---
    function autoFitGraph() {
        const { a, b, c, d } = state.functions;
        const criticalPoints = [];
        
        // Add critical points
        criticalPoints.push(b, d);
        
        // Calculate y values at critical points and some nearby points
        const testPoints = [...criticalPoints, b-2, b+2, d-2, d+2, 0];
        const yValues = testPoints.map(x => a * Math.abs(x - b) + c * Math.abs(x - d));
        
        // Find bounds
        const xMin = Math.min(...testPoints) - 2;
        const xMax = Math.max(...testPoints) + 2;
        const yMin = Math.min(...yValues, 0) - 2;
        const yMax = Math.max(...yValues) + 2;
        
        // Update plot with new range
        const layout = {
            xaxis: { title: 'x', range: [xMin, xMax], gridcolor: '#e0e0e0' },
            yaxis: { title: 'y', range: [yMin, yMax], gridcolor: '#e0e0e0' },
            margin: { l: 50, r: 20, t: 20, b: 40 },
            showlegend: true,
            hovermode: 'closest'
        };
        
        Plotly.relayout(functionPlot, layout);
    }
    
    function resetView() {
        const layout = {
            xaxis: { title: 'x', range: [-10, 10], gridcolor: '#e0e0e0' },
            yaxis: { title: 'y', range: [-10, 10], gridcolor: '#e0e0e0' },
            margin: { l: 50, r: 20, t: 20, b: 40 },
            showlegend: true,
            hovermode: 'closest'
        };
        
        Plotly.relayout(functionPlot, layout);
    }

    // --- FUNCTIONS TAB ---
    function updateFunction() {
        // Update state
        state.functions.a = parseFloat(aSlider.value);
        state.functions.b = parseFloat(bSlider.value);
        state.functions.c = parseFloat(cSlider.value);
        state.functions.d = parseFloat(dSlider.value);

        // Update displays
        aValue.textContent = state.functions.a.toFixed(1);
        bValue.textContent = state.functions.b.toFixed(1);
        cValue.textContent = state.functions.c.toFixed(1);
        dValue.textContent = state.functions.d.toFixed(1);

        renderFunction();
        updateEquation();
        updateInfo();
    }

    function renderFunction() {
        const { a, b, c, d } = state.functions;
        const x = [], y = [];
        
        for (let xi = PLOT_RANGE_X[0]; xi <= PLOT_RANGE_X[1]; xi += 0.1) {
            x.push(xi);
            y.push(a * Math.abs(xi - b) + c * Math.abs(xi - d));
        }

        const traces = [{
            x: x,
            y: y,
            type: 'scatter',
            mode: 'lines',
            line: { color: '#0f766e', width: 3 },
            name: 'f(x)'
        }];

        // Add vertex points
        if (state.features.vertex) {
            const vertices = [];
            if (a !== 0) vertices.push({ x: b, y: c * Math.abs(b - d) });
            if (c !== 0) vertices.push({ x: d, y: a * Math.abs(d - b) });
            
            if (vertices.length > 0) {
                traces.push({
                    x: vertices.map(v => v.x),
                    y: vertices.map(v => v.y),
                    type: 'scatter',
                    mode: 'markers',
                    marker: { color: '#c62828', size: 10 },
                    name: 'Vertices'
                });
            }
        }

        // Add intercepts
        if (state.features.intercepts) {
            // Y-intercept
            const yInt = a * Math.abs(0 - b) + c * Math.abs(0 - d);
            traces.push({
                x: [0],
                y: [yInt],
                type: 'scatter',
                mode: 'markers',
                marker: { color: '#f59e0b', size: 8 },
                name: 'Y-intercept'
            });
        }

        // Add trace points
        if (state.features.trace && state.tracePoints.length > 0) {
            traces.push({
                x: state.tracePoints.map(p => p.x),
                y: state.tracePoints.map(p => p.y),
                type: 'scatter',
                mode: 'markers',
                marker: { color: '#10b981', size: 5 },
                name: 'Trace'
            });
        }

        const layout = {
            xaxis: { title: 'x', range: PLOT_RANGE_X, gridcolor: '#e0e0e0' },
            yaxis: { title: 'y', range: PLOT_RANGE_Y, gridcolor: '#e0e0e0' },
            margin: { l: 50, r: 20, t: 20, b: 40 },
            showlegend: true,
            hovermode: 'closest'
        };

        Plotly.newPlot(functionPlot, traces, layout, {
            responsive: true,
            displaylogo: false
        });

        // Add click handler for trace
        if (state.features.trace) {
            functionPlot.on('plotly_click', (data) => {
                const point = data.points[0];
                state.tracePoints.push({ x: point.x, y: point.y });
                if (state.tracePoints.length > 20) state.tracePoints.shift();
                renderFunction();
            });
        }
    }

    function updateEquation() {
        const { a, b, c, d } = state.functions;
        let eq = 'y = ';
        
        if (a !== 0) {
            if (a === -1) eq += '-';
            else if (a !== 1) eq += a.toFixed(1);
            eq += `|x ${b >= 0 ? '- ' + b.toFixed(1) : '+ ' + (-b).toFixed(1)}|`;
        }
        
        if (c !== 0) {
            if (c > 0) eq += ' + ';
            else eq += ' - ';
            if (Math.abs(c) !== 1) eq += Math.abs(c).toFixed(1);
            eq += `|x ${d >= 0 ? '- ' + d.toFixed(1) : '+ ' + (-d).toFixed(1)}|`;
        }

        if (a === 0 && c === 0) eq = 'y = 0';

        functionEquation.innerHTML = `<p><strong>${eq}</strong></p>`;
    }

    function updateInfo() {
        const pills = [];
        
        if (state.features.vertex) {
            pills.push('Vertices shown in red');
        }
        if (state.features.intercepts) {
            pills.push('Y-intercept in orange');
        }
        if (state.features.trace) {
            pills.push('Click to add trace points');
        }
        if (state.features.transformations) {
            const { a, b, c, d } = state.functions;
            if (b !== 0) pills.push(`Shifted ${b > 0 ? 'right' : 'left'} by ${Math.abs(b)}`);
            if (d !== 0) pills.push(`Second shift ${d > 0 ? 'right' : 'left'} by ${Math.abs(d)}`);
            if (Math.abs(a) > 1) pills.push(`Stretched vertically by ${Math.abs(a)}`);
            if (Math.abs(a) < 1 && a !== 0) pills.push(`Compressed vertically by ${Math.abs(a)}`);
        }

        functionInfo.innerHTML = pills.map(p => `<span class="info-pill">${p}</span>`).join('');
    }

    // --- INEQUALITIES TAB ---
    function updateInequality() {
        const match = inequalityInput.value.match(/\|x\s*([-+])?\s*([0-9.]*)?\|\s*([<>]=?)\s*([0-9.]+)/);
        
        if (match) {
            let a = 0;
            if (match[2]) {
                a = parseFloat(match[2]);
                if (match[1] === '+') a = -a;
            }
            
            state.inequalities = {
                a: a,
                k: parseFloat(match[4]),
                operator: match[3]
            };
            
            drawNumberLine();
            updateInequalityOutput();
        }
    }

    function drawNumberLine() {
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        
        const w = canvas.width;
        const h = canvas.height;
        const lineY = h / 2;
        const { a, k, operator } = state.inequalities;
        
        const scale = w / (NUMBER_LINE_RANGE[1] - NUMBER_LINE_RANGE[0]);
        const toX = val => (val - NUMBER_LINE_RANGE[0]) * scale;
        
        ctx.clearRect(0, 0, w, h);
        
        // Draw solution region
        ctx.fillStyle = operator.includes('<') ? 
            'rgba(15, 118, 110, 0.2)' : 
            'rgba(197, 48, 48, 0.2)';
        
        const left = toX(a - k);
        const right = toX(a + k);
        
        if (operator.includes('<')) {
            ctx.fillRect(left, lineY - 10, right - left, 20);
        } else {
            ctx.fillRect(0, lineY - 10, left, 20);
            ctx.fillRect(right, lineY - 10, w - right, 20);
        }
        
        // Draw number line
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, lineY);
        ctx.lineTo(w, lineY);
        ctx.stroke();
        
        // Draw ticks
        ctx.font = '12px sans-serif';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        
        for (let i = -20; i <= 20; i += 5) {
            const x = toX(i);
            ctx.beginPath();
            ctx.moveTo(x, lineY - 5);
            ctx.lineTo(x, lineY + 5);
            ctx.stroke();
            ctx.fillText(i, x, lineY + 20);
        }
        
        // Draw boundary points
        ctx.strokeStyle = '#0f766e';
        ctx.lineWidth = 3;
        
        [left, right].forEach(x => {
            ctx.beginPath();
            ctx.arc(x, lineY, 6, 0, 2 * Math.PI);
            if (operator === '<' || operator === '>') {
                ctx.stroke();
            } else {
                ctx.fillStyle = '#0f766e';
                ctx.fill();
            }
        });
        
        // Draw center point
        ctx.fillStyle = '#c62828';
        ctx.beginPath();
        ctx.arc(toX(a), lineY, 5, 0, 2 * Math.PI);
        ctx.fill();
    }

    function updateInequalityOutput() {
        const { a, k, operator } = state.inequalities;
        const left = a - k;
        const right = a + k;
        
        let interval = '';
        if (operator.includes('<')) {
            const lb = operator === '<=' ? '[' : '(';
            const rb = operator === '<=' ? ']' : ')';
            interval = `${lb}${left}, ${right}${rb}`;
        } else {
            const lb = operator === '>=' ? ']' : ')';
            const rb = operator === '>=' ? '[' : '(';
            interval = `(-∞, ${left}${lb} ∪ ${rb}${right}, +∞)`;
        }
        
        inequalityOutput.innerHTML = `
            <p><strong>Solution: ${interval}</strong></p>
            <p style="font-size: 0.9rem; color: #666;">
                Distance from ${a} is ${operator} ${k}
            </p>
        `;
    }

    init();
}
</script>
</body>
</html>
