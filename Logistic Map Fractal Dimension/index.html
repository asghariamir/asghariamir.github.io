' + <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Logistic Map – ε-table underneath the attractor band</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.plot.ly/plotly-2.24.2.min.js"></script>
<style>
 body{font-family:Arial,Helvetica,sans-serif; margin:1rem; background:#fafafa;}

 /* plots */
 #plots      {display:flex; flex-direction:column; gap:1.6rem;}
 #bifPlot,
 #slicePlot  {width:100%; height:400px;}

 /* sliders */
 #controls   {display:flex; flex-wrap:wrap; align-items:center; gap:.7rem;
              margin-top:-1rem;}
 #controls input[type=range]{flex:1 1 220px;}

 /* table looks nicer & centred */
 table        {border-collapse:collapse; margin:0 auto; max-width:26rem;}
 thead th     {background:#eaeaea; padding:.4rem .8rem;}
 tbody td     {padding:.35rem .8rem; border:1px solid #bbb; text-align:center;}
 tbody tr:nth-child(odd){background:#f9f9f9;}
 tbody tr:hover{background:#fff6d0;}
 button       {cursor:pointer; padding:.3rem .8rem; margin-right:.4rem;}
 .disabled    {opacity:.35; cursor:default}
 code{background:#f0f0f0; padding:.1rem .3rem; border-radius:.25rem;}
</style>
</head>
<body>

<h2>Logistic-Map Explorer (build ε-table → graphs)</h2>

<div id="plots">
  <!-- 1 – BIFURCATION -->
  <div id="bifPlot"></div>

  <!-- 2 – CONTROLS -->
  <div id="controls">
      r =<span id="rVal">3.8000</span>
      <input type="range" id="rSlider" min="2.5" max="4" step="0.0001" value="3.8">

      x₀ =<span id="x0Val">0.5000</span>
      <input type="range" id="x0Slider" min="0.01" max="0.99" step="0.0001" value="0.5">

      points
      <input type="number" id="keepInput" value="10000" min="1" max="20000" step="1" style="width:5rem">

      k =<span id="kVal">8</span>
      <input type="range" id="kSlider" min="4" max="12" step="1" value="8" style="flex:1 1 160px">

      ε =<span id="epsVal">2⁻⁸</span>
      N(ε) =<span id="nVal">-</span>
  </div>

  <!-- 3 – BAND -->
  <h3 id="sliceTitle">Attractor & ε-boxes (post-transient)</h3>
  <div id="slicePlot"></div>
</div>

<!-- 4 – ε-TABLE  -->
<h3 style="text-align:center">Build your ε-table</h3>
<div style="text-align:center; margin-bottom:.4rem">
   <button id="addBtn">Add row</button>
   <button id="clrBtn">Clear</button>
   <button id="plotBtn" class="disabled">Plot table</button>
</div>

<table id="epsTable">
  <thead>
    <tr><th>#</th><th>k</th><th>ε</th><th>N(ε)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
/* ------------- numerical parameters ------------------------------- */
const SKIP_SLICE = 2000;          // discard for slice plot
const SKIP_DIM   = 8192;          // discard for N(ε)
const KEEP_DIM   = 65536;         // length for N(ε)

/* ------------- logistic helpers ----------------------------------- */
function step(r,x){ return r*x*(1-x); }
function series(r,len,skip,x0){
    let x=x0, arr=[];
    for(let i=0;i<skip+len;i++){ x=step(r,x); if(i>=skip) arr.push(x);}
    return arr;
}

/* ------------- bifurcation background ----------------------------- */
const R_MIN=2.5, R_MAX=4, R_STEP=0.0015;
const bifX=[], bifR=[];
for(let rr=R_MIN; rr<=R_MAX+1e-8; rr+=R_STEP){
  series(rr,800,200,Math.random()*0.8+0.1)
      .forEach(x=>{bifR.push(rr); bifX.push(x);});
}
Plotly.newPlot('bifPlot',[{
        x:bifR, y:bifX, mode:'markers', type:'scattergl',
        marker:{size:1, color:'#888'}
}], {xaxis:{title:'r', range:[R_MIN,R_MAX]},
     yaxis:{title:'x', range:[0,1]},
     margin:{l:50,r:5,t:10,b:40}, dragmode:false})
.then(()=>Plotly.addTraces('bifPlot',{
     x:[3.8,3.8], y:[0,1], mode:'lines',
     line:{color:'crimson', width:3}}));

/* ------------- interactive state ---------------------------------- */
let r=3.8, x0=0.5, keepVis=10000, k=8;

/* ------------- useful helpers ------------------------------------- */
const rows=[],   tbody=document.querySelector('#epsTable tbody');
const lg2 = Math.log2 ? Math.log2 : x=>Math.log(x)/Math.LN2;
function epsFromK(k){ return 1/(1<<k); }
function NofEps(eps){
  const xs = series(r, KEEP_DIM, SKIP_DIM, x0);
  return new Set(xs.map(x=>Math.floor(x/eps))).size;
}
function updateENreadout(){
  const eps = epsFromK(k);
  epsVal.textContent = `2⁻${k}`;
  nVal .textContent  = NofEps(eps);
}

/* ------------- draw slice (band) ---------------------------------- */
function drawSlice(){
  const xs  = series(r, keepVis, SKIP_SLICE, x0);
  const eps = epsFromK(k);
  const filled = new Set(xs.map(x=>Math.floor(x/eps)));

  updateENreadout();

  const shapes=[], nBoxes=1/eps;
  for(let b=0;b<nBoxes;b++){
     shapes.push({type:'rect', xref:'paper', yref:'y',
                  x0:0, x1:1, y0:b*eps, y1:(b+1)*eps,
                  fillcolor: filled.has(b)
                       ? 'rgba(255,165,0,0.25)'
                       : 'rgba(150,150,150,0.05)',
                  line:{width:0}});
  }
  const idx = xs.map((_,i)=>i);
  Plotly.newPlot('slicePlot',[{x:idx,y:xs,mode:'markers',
                               marker:{size:3,color:'royalblue'}}],
     {xaxis:{title:'n',range:[0,keepVis]},
      yaxis:{title:'x',range:[0,1]},
      margin:{l:60,r:5,t:30,b:40}, dragmode:false, shapes});
}
drawSlice();

/* ------------- slider / input handlers ---------------------------- */
rSlider.oninput = e=>{r=+e.value; rVal.textContent=r.toFixed(4);
                      Plotly.restyle('bifPlot',{'x':[[r,r]]},[1]); drawSlice();}
x0Slider.oninput= e=>{x0=+e.value; x0Val.textContent=x0.toFixed(4); drawSlice();}
keepInput.oninput=e=>{keepVis=Math.max(1,+e.value|0); drawSlice();}
kSlider.oninput  = e=>{k=+e.value; kVal.textContent=k; drawSlice();}

/* ------------- ε-table helpers ------------------------------------ */
function refreshTable(){
  tbody.innerHTML='';
  rows.forEach((row,i)=>{
     const tr=tbody.insertRow();
     tr.insertCell().textContent = i+1;
     tr.insertCell().textContent = row.k;
     tr.insertCell().textContent = `2⁻${row.k}`;
     tr.insertCell().textContent = row.N;
  });
  plotBtn.classList.toggle('disabled', rows.length<2);
}

/* ADD row */
addBtn.onclick = ()=>{
  const eps = epsFromK(k);
  const N   = NofEps(eps);
  rows.push({k, N}); refreshTable();
};

/* CLEAR table */
clrBtn.onclick = ()=>{ rows.length=0; refreshTable(); };

/* ------------- plot from table ------------------------------------ */
plotBtn.onclick = ()=>{
  if(rows.length<2) return;

  const eps = rows.map(r=>epsFromK(r.k)),
        N   = rows.map(r=>r.N);

  /* linear trace */
  const trLin={x:eps, y:N, mode:'markers+lines',
               marker:{color:'royalblue'}, name:'N(ε)'};

  /* log–log fit */
  const logX=eps.map(e=>Math.log10(1/e)),
        logY=N  .map(n=>Math.log10(n));
  const n=logX.length, sx=logX.reduce((a,b)=>a+b),
        sy=logY.reduce((a,b)=>a+b),
        sxy=logX.reduce((s,x,i)=>s+x*logY[i],0),
        sx2=logX.reduce((s,x)=>s+x*x,0);
  const m=(n*sxy-sx*sy)/(n*sx2-sx*sx),
        b=(sy-m*sx)/n, D=m.toFixed(3);
  const fitY=eps.map(e=>10**(b+m*Math.log10(1/e)));

  const trLog={x:eps,y:N,mode:'markers',
               marker:{size:6,color:'seagreen'}, name:'N(ε)'},
        trFit={x:eps,y:fitY,mode:'lines',
               line:{dash:'dot',color:'crimson'},
               name:`fit, slope≈${D}`};

  Plotly.newPlot('slicePlot',
    [{...trLin,xaxis:'x', yaxis:'y'},
     {...trLog,xaxis:'x2',yaxis:'y2'},
     {...trFit,xaxis:'x2',yaxis:'y2'}],
    {grid:{rows:1,columns:2,pattern:'independent'},
     xaxis :{title:'ε'},
     yaxis :{title:'N(ε)'},
     xaxis2:{title:'ε',type:'log'},
     yaxis2:{title:'N(ε)',type:'log'},
     margin:{l:60,r:20,t:30,b:50},
     showlegend:true});
  sliceTitle.textContent=`ε-table plotted  —  dimension ≈ ${D}`;
};
</script>
</body>
</html>




      
    



