' + <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Logistic Map – ε-table below the attractor band</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.plot.ly/plotly-2.24.2.min.js"></script>
<style>
 body{font-family:Arial,sans-serif;margin:1rem;background:#fafafa;}
 #plots{display:flex;flex-direction:column;gap:1.6rem;}
 #bifPlot,#slicePlot{width:100%;height:400px;}
 #controls{display:flex;flex-wrap:wrap;align-items:center;
           gap:.6rem;margin-top:-1rem;}
 #controls input[type=range]{flex:1 1 220px;}
 table{border-collapse:collapse;margin-top:.5rem}
 th,td{border:1px solid #999;padding:.25rem .7rem;text-align:right;}
 th{background:#f3f3f3}
 button{cursor:pointer}
 .disabled{opacity:.35;cursor:default}
</style>
</head>
<body>

<h2>Logistic-Map Explorer (ε-table → graphs)</h2>

<div id="plots">
  <!-- 1) bifurcation diagram -->
  <div id="bifPlot"></div>

  <!-- 2) parameter controls -->
  <div id="controls">
      r&nbsp;=<span id="rVal">3.8000</span>
      <input type="range" id="rSlider" min="2.5" max="4"
             step="0.0001" value="3.8">

      x₀&nbsp;=<span id="x0Val">0.5000</span>
      <input type="range" id="x0Slider" min="0.01" max="0.99"
             step="0.0001" value="0.5">

      points&nbsp;
      <input type="number" id="keepInput" value="10000"
             min="1" max="20000" step="1" style="width:5rem">

      k&nbsp;=<span id="kVal">8</span>
      <input type="range" id="kSlider" min="4" max="12"
             step="1" value="8" style="flex:1 1 160px">

      ε&nbsp;=<span id="epsVal">1/256</span>
      N(ε)&nbsp;=<span id="nVal">-</span>
  </div>

  <!-- 3) slice panel (band with ε-boxes) -->
  <h3 id="sliceTitle">Attractor &amp; ε-boxes (post-transient)</h3>
  <div id="slicePlot"></div>
</div>

<!-- 4) ε-table and its buttons, now *below* the band -->
<h3>Build your ε-table</h3>
<button id="addBtn">Add row</button>
<button id="clrBtn">Clear</button>
<button id="plotBtn" class="disabled">Plot table</button>

<table id="epsTable">
  <thead><tr><th>#</th><th>k</th><th>ε = 2<sup>−k</sup></th><th>N(ε)</th></tr></thead>
  <tbody></tbody>
</table>

<script>
/* -------- numeric parameters ----------------------------------- */
const SKIP_SLICE = 2000;      // burn-in for slice panel
const SKIP_DIM   = 8192;      // burn-in for N(ε)
const KEEP_DIM   = 65536;     // length used when counting boxes

/* -------- logistic helpers ------------------------------------- */
function step(r,x){return r*x*(1-x);}
function makeSeries(r,keep,skip,x0){
  let x=x0, arr=[];
  for(let i=0;i<skip+keep;i++){x=step(r,x); if(i>=skip) arr.push(x);}
  return arr;
}

/* -------- bifurcation background ------------------------------- */
const R_MIN=2.5,R_MAX=4,R_STEP=0.0015;
const bifX=[], bifR=[];
for(let rr=R_MIN; rr<=R_MAX+1e-8; rr+=R_STEP){
    makeSeries(rr,800,200,Math.random()*0.8+0.1)
      .forEach(x=>{bifR.push(rr); bifX.push(x);});
}
Plotly.newPlot('bifPlot',[{x:bifR,y:bifX,mode:'markers',type:'scattergl',
                           marker:{size:1,color:'#888'}}],
   {xaxis:{title:'r',range:[R_MIN,R_MAX]},
    yaxis:{title:'x',range:[0,1]},
    margin:{l:50,r:5,t:10,b:40},dragmode:false})
   .then(()=>Plotly.addTraces('bifPlot',
        {x:[3.8,3.8],y:[0,1],mode:'lines',
         line:{color:'crimson',width:3}}));

/* -------- interactive state ------------------------------------ */
let r=3.8, x0=0.5, keepVis=10000, k=8;

/* -------- helpers for ε and N(ε) ------------------------------ */
const lg2 = Math.log2 ? x=>Math.log2(x) : x=>Math.log(x)/Math.LN2;
function fmtE(e){return e<.01?e.toExponential(1):`1/${1/e}`;}
function calcN(eps){
  const xs=makeSeries(r,KEEP_DIM,SKIP_DIM,x0);
  return new Set(xs.map(x=>Math.floor(x/eps))).size;
}

/* -------- draw slice panel with ε-boxes ----------------------- */
function drawSlice(){
  const xs = makeSeries(r,keepVis,SKIP_SLICE,x0);
  const eps=1/(1<<k);
  const filled=new Set(xs.map(x=>Math.floor(x/eps)));
  epsVal.textContent=fmtE(eps);
  nVal .textContent=filled.size;

  /* stripes */
  const stripes=[];
  for(let b=0;b<1/eps;b++){
    stripes.push({type:'rect',xref:'paper',yref:'y',x0:0,x1:1,
                  y0:b*eps,y1:(b+1)*eps,
                  fillcolor:filled.has(b)?
                            'rgba(255,165,0,.25)':'rgba(150,150,150,.05)',
                  line:{width:0}});
  }
  const idx = xs.map((_,i)=>i);
  Plotly.newPlot('slicePlot',
    [{x:idx,y:xs,mode:'markers',
      marker:{size:3,color:'royalblue'}}],
    {xaxis:{title:'n',range:[0,keepVis]},
     yaxis:{title:'x',range:[0,1]},
     margin:{l:60,r:5,t:30,b:40},
     shapes:stripes,dragmode:false});
}
drawSlice();

/* -------- slider handlers ------------------------------------- */
rSlider.oninput=e=>{r=+e.value;rVal.textContent=r.toFixed(4);
                    Plotly.restyle('bifPlot',{'x':[[r,r]]},[1]);
                    drawSlice();};
x0Slider.oninput=e=>{x0=+e.value;x0Val.textContent=x0.toFixed(4);drawSlice();}
keepInput.oninput=e=>{keepVis=Math.max(1,+e.value|0);drawSlice();}
kSlider.oninput=e=>{k=+e.value;kVal.textContent=k;drawSlice();}

/* -------- ε-table management ---------------------------------- */
const rows=[];                        // objects {k, eps, N}
const tbody=document.querySelector('#epsTable tbody');
function refreshTable(){
  tbody.innerHTML='';
  rows.forEach((row,i)=>{
     const tr=tbody.insertRow();
     tr.insertCell().textContent=i+1;
     tr.insertCell().textContent=row.k;
     tr.insertCell().textContent=fmtE(row.eps);
     tr.insertCell().textContent=row.N;
  });
  plotBtn.classList.toggle('disabled',rows.length<2);
}

/* ADD ROW */
addBtn.onclick=()=>{
  const eps=1/(1<<k);
  const N  =calcN(eps);
  rows.push({k,eps,N}); refreshTable();
};

/* CLEAR table */
clrBtn.onclick=()=>{rows.length=0; refreshTable();};

/* -------- plot button ---------------------------------------- */
plotBtn.onclick=()=>{
  if(rows.length<2) return;
  const eps=rows.map(r=>r.eps), N=rows.map(r=>r.N);

  /* linear trace */
  const trLin={x:eps,y:N,mode:'markers+lines',
               marker:{color:'royalblue'},name:'N(ε)'};

  /* log–log fit */
  const logX=eps.map(e=>Math.log10(1/e));
  const logY=N  .map(n=>Math.log10(n));
  const n=logX.length,sx=logX.reduce((a,b)=>a+b),
        sy=logY.reduce((a,b)=>a+b),
        sxy=logX.reduce((s,x,i)=>s+x*logY[i],0),
        sx2=logX.reduce((s,x)=>s+x*x,0);
  const m=(n*sxy-sx*sy)/(n*sx2-sx*sx),
        b=(sy-m*sx)/n, D=m.toFixed(3);
  const fitY=eps.map(e=>10**(b+m*Math.log10(1/e)));

  const trLog={x:eps,y:N,mode:'markers',
               marker:{size:6,color:'seagreen'},name:'N(ε)'},
        trFit={x:eps,y:fitY,mode:'lines',
               line:{dash:'dot',color:'crimson'},
               name:`fit, slope≈${D}`};

  Plotly.newPlot('slicePlot',
    [{...trLin,xaxis:'x', yaxis:'y'},
     {...trLog,xaxis:'x2',yaxis:'y2'},
     {...trFit,xaxis:'x2',yaxis:'y2'}],
    {grid:{rows:1,columns:2,pattern:'independent'},
     xaxis :{title:'ε'},
     yaxis :{title:'N(ε)'},
     xaxis2:{title:'ε',type:'log'},
     yaxis2:{title:'N(ε)',type:'log'},
     margin:{l:60,r:20,t:30,b:50},showlegend:true});
  sliceTitle.textContent=
     `ε-table plotted  —  dimension ≈ ${D}`;
};
</script>
</body>
</html>
 + '

   
      
    



