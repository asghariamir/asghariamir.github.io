<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Logistic Map 1D Box-Counting Dimension Explorer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; }
    #controls { margin: 1em 0; }
    label { margin-right: 1em; }
    canvas { border: 1px solid #999; display: block; margin-bottom: 1em; }
    #loglog { background: #fff; }
    .container { display: flex; flex-wrap: wrap; gap: 2em;}
  </style>
</head>
<body>
  <h2>Logistic Map Fractal Dimension Explorer (1D Box-Counting)</h2>
  <div id="controls">
    <label>r: <input type="range" id="rSlider" min="3.5" max="4" step="0.001" value="3.900"/> <span id="rValue">3.900</span></label>
    <label>Boxes (N): <input type="range" id="boxSlider" min="10" max="200" step="1" value="50"/> <span id="boxValue">50</span></label>
    <button id="addPoint">Add Data Point</button>
    <button id="clearData">Clear Data</button>
  </div>
  <div class="container">
    <canvas id="logmap"></canvas>
    <canvas id="loglog" width="400" height="300"></canvas>
  </div>
  <p>
    <b>Instructions:</b> Adjust <code>r</code> for the logistic map. Change the box count <code>N</code>, then press <b>Add Data Point</b> to add (<code>N</code>, <code>Number of occupied boxes</code>) to the log-log plot. The log-log plot slope estimates the box-counting dimension.
  </p>
  <script>
    // Parameters
    let r = 3.9;
    let x0 = 0.2;
    let iterations = 2500, skip = 500;
    let points = [];
    let boxCount = 50;
    let boxData = []; // {N, nOccupied, eps}

    // --- Setup Controls ---
    const rSlider = document.getElementById('rSlider');
    const rValue = document.getElementById('rValue');
    rSlider.oninput = function() {
      r = parseFloat(rSlider.value);
      rValue.textContent = r.toFixed(3);
      generateLogisticMap();
      redrawMain();
    };

    const boxSlider = document.getElementById('boxSlider');
    const boxValue = document.getElementById('boxValue');
    boxSlider.oninput = function() {
      boxCount = parseInt(boxSlider.value);
      boxValue.textContent = boxCount;
      redrawMain();
    };

    document.getElementById('addPoint').onclick = function() {
      let N = boxCount;
      let {nOccupied, eps} = countBoxes(N);
      if (!boxData.some(d => d.N === N)) {
        boxData.push({N, nOccupied, eps});
        drawLogLogPlot();
      }
    };

    document.getElementById('clearData').onclick = function() {
      boxData = [];
      drawLogLogPlot();
    };

    // --- Logistic Map Data Generation ---
    function generateLogisticMap() {
      let x = x0;
      points = [];
      for (let i = 0; i < iterations + skip; i++) {
        x = r * x * (1 - x);
        if (i >= skip) points.push(x);
      }
    }

    // --- Box Counting Logic ---
    function countBoxes(N) {
      let occupied = new Array(N).fill(false);
      points.forEach(x => {
        let box = Math.floor(x * N);
        if (box >= 0 && box < N) occupied[box] = true;
      });
      let nOccupied = occupied.filter(b => b).length;
      let eps = 1.0 / N;
      return {nOccupied, eps, occupied};
    }

    // --- Drawing Functions ---
    function redrawMain() {
      drawMap();
      drawLogLogPlot();
    }

    // 1D correct visualization
    function drawMap() {
      const c = document.getElementById('logmap');
      c.width = 700; c.height = 140;
      const ctx = c.getContext('2d');
      ctx.clearRect(0,0,c.width,c.height);

      // Margins
      let left = 60, right = 30, bottom = 40;
      let width = c.width - left - right;
      let boxBaseY = c.height - bottom;
      let boxHeight = 30;

      // Draw grid (1D row of boxes)
      let N = boxCount;
      let boxW = width / N;
      ctx.font = "12px sans-serif";

      // Draw all boxes (light gray)
      for (let i = 0; i < N; i++) {
        ctx.beginPath();
        ctx.rect(left + i * boxW, boxBaseY, boxW, boxHeight);
        ctx.strokeStyle = "#bbb";
        ctx.lineWidth = 1;
        ctx.stroke();
      }

      // Occupied boxes: highlight
      let {occupied} = countBoxes(N);
      for (let i = 0; i < N; i++) {
        if (occupied[i]) {
          ctx.fillStyle = "rgba(255,85,85,0.42)";
          ctx.fillRect(left + i * boxW, boxBaseY, boxW, boxHeight);
          ctx.strokeStyle = "#d32f2f";
          ctx.lineWidth = 2;
          ctx.strokeRect(left + i * boxW, boxBaseY, boxW, boxHeight);
        }
      }

      // Draw logistic map points (just above the boxes, as vertical lines)
      ctx.strokeStyle = "#1976d2";
      ctx.lineWidth = 1;
      points.forEach(x => {
        let px = left + x * width;
        ctx.beginPath();
        ctx.moveTo(px, boxBaseY - 1



