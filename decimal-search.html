<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decimal Search Root-Finder</title>
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
    <style>
        :root {
            --primary-color: #1565c0;
            --secondary-color: #4caf50;
            --danger-color: #d32f2f;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #424242;
            --text-color: #212121;
            --highlight-bg: rgba(21, 101, 192, 0.1);
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--light-gray);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            padding: 1rem;
        }
        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            padding: 1.5rem;
        }
        h2 { font-size: 1.75rem; color: var(--primary-color); margin-bottom: 0.5rem; text-align: center; }
        p.info { color: #616161; margin-bottom: 1.5rem; text-align: center; max-width: 700px; margin-left: auto; margin-right: auto;}
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem 1.5rem;
            padding: 1rem;
            background-color: var(--light-gray);
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }
        .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 1rem; }
        
        label { font-size: 0.9rem; font-weight: 600; color: #616161; }
        input[type="number"], select { border: 1px solid var(--medium-gray); border-radius: 4px; padding: 8px; font-size: 0.9rem; width: 100%; }
        
        button { background-color: var(--primary-color); color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; transition: background-color 0.3s; }
        button:hover { background-color: #1976d2; }
        .secondary-button { background-color: #6c757d; }
        .secondary-button:hover { background-color: #5a6268; }
        .danger-button { background-color: var(--danger-color); }
        .danger-button:hover { background-color: #c62828; }
        button:disabled { background-color: #bdbdbd; cursor: not-allowed; }

        .plot-container { width: 100%; height: 400px; border: 1px solid var(--medium-gray); border-radius: 4px; margin-bottom: 1.5rem;}
        
        .log-container { max-height: 300px; overflow-y: auto; border: 1px solid var(--medium-gray); border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th, td { border-bottom: 1px solid var(--medium-gray); padding: 8px; text-align: center; }
        thead th { background-color: var(--light-gray); font-weight: 600; position: sticky; top: 0; z-index: 1;}
        tbody tr:last-child td { border-bottom: none; }
    </style>
</head>
<body>
<div class="container">
    <h2>Decimal Search Root-Finder</h2>
    <p class="info">This tool demonstrates the Bisection Method for finding a root of an equation <strong>f(x) = 0</strong>. Choose a function and an interval [a, b] where the function's sign changes, then step through the process to see how the interval is narrowed to find the solution.</p>
    
    <div class="controls">
        <div class="control-group">
            <label for="function-select">Choose a function f(x):</label>
            <select id="function-select"></select>
        </div>
        <div class="control-group">
            <label for="a-input">Interval Start (a):</label>
            <input type="number" id="a-input" value="-1">
        </div>
        <div class="control-group">
            <label for="b-input">Interval End (b):</label>
            <input type="number" id="b-input" value="2">
        </div>
        <div class="control-group">
            <label for="tolerance-input">Tolerance:</label>
            <input type="number" id="tolerance-input" value="0.0001" step="0.0001">
        </div>
    </div>

    <div id="plot-container" class="plot-container"></div>
    
    <div class="button-group">
        <button id="start-btn">Start Search</button>
        <button id="step-btn" class="secondary-button" disabled>Step</button>
        <button id="animate-btn" class="secondary-button" disabled>Animate</button>
        <button id="reset-btn" class="danger-button" disabled>Reset</button>
    </div>

    <div class="log-container">
        <table id="log-table">
            <thead>
                <tr><th>Iteration</th><th>a</th><th>b</th><th>Midpoint (m)</th><th>f(m)</th><th>New Interval Width</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- FUNCTIONS TO SOLVE ---
    const FUNCTIONS = {
        "x³ - x - 2": { fn: x => Math.pow(x, 3) - x - 2, range: [-2, 3] },
        "x² - 3": { fn: x => x*x - 3, range: [0, 3] },
        "cos(x) - x": { fn: x => Math.cos(x) - x, range: [-2, 2] },
        "eˣ - 5x": { fn: x => Math.exp(x) - 5*x, range: [0, 3]}
    };

    // --- STATE & DOM REFS ---
    let state = {
        f: null, a: 0, b: 0, m: 0,
        iteration: 0, tolerance: 0.0001,
        log: [], isRunning: false,
        animationInterval: null
    };

    const functionSelect = document.getElementById('function-select');
    const aInput = document.getElementById('a-input');
    const bInput = document.getElementById('b-input');
    const toleranceInput = document.getElementById('tolerance-input');
    const startBtn = document.getElementById('start-btn');
    const stepBtn = document.getElementById('step-btn');
    const animateBtn = document.getElementById('animate-btn');
    const resetBtn = document.getElementById('reset-btn');
    const plotContainer = document.getElementById('plot-container');
    const logTableBody = document.querySelector('#log-table tbody');
    
    // --- CORE LOGIC ---
    function initialize() {
        Object.keys(FUNCTIONS).forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            functionSelect.appendChild(option);
        });
        
        functionSelect.addEventListener('change', resetAndPlot);
        aInput.addEventListener('change', resetAndPlot);
        bInput.addEventListener('change', resetAndPlot);
        toleranceInput.addEventListener('change', () => { state.tolerance = parseFloat(toleranceInput.value); });
        
        startBtn.addEventListener('click', startSearch);
        stepBtn.addEventListener('click', performStep);
        animateBtn.addEventListener('click', toggleAnimation);
        resetBtn.addEventListener('click', resetAndPlot);
        
        resetAndPlot();
    }
    
    function resetAndPlot() {
        stopAnimation();
        state.isRunning = false;
        state.iteration = 0;
        state.log = [];
        state.a = parseFloat(aInput.value);
        state.b = parseFloat(bInput.value);
        state.tolerance = parseFloat(toleranceInput.value);
        state.f = FUNCTIONS[functionSelect.value].fn;

        updateButtons();
        renderLog();
        plotFunction();
    }

    function startSearch() {
        const fa = state.f(state.a);
        const fb = state.f(state.b);

        if (fa * fb >= 0) {
            alert("The function must have opposite signs at the interval endpoints (f(a) * f(b) < 0). Please choose a different interval.");
            return;
        }
        
        state.isRunning = true;
        updateButtons();
        updatePlotAnnotations();
    }
    
    function performStep() {
        if (!state.isRunning || Math.abs(state.b - state.a) < state.tolerance) {
            stopAnimation();
            updateButtons();
            return false;
        }

        state.iteration++;
        const fa = state.f(state.a);
        state.m = (state.a + state.b) / 2;
        const fm = state.f(state.m);

        state.log.push({
            iter: state.iteration, a: state.a, b: state.b,
            m: state.m, fm: fm, width: Math.abs(state.b - state.a)
        });

        if (Math.abs(fm) < 1e-12) { // Virtually zero
            state.b = state.m; // Found exact root
        } else if (fa * fm < 0) {
            state.b = state.m; // Root is in the left half
        } else {
            state.a = state.m; // Root is in the right half
        }
        
        renderLog();
        updatePlotAnnotations();
        
        if (Math.abs(state.b - state.a) < state.tolerance) {
            state.isRunning = false;
            updateButtons();
            return false;
        }
        return true;
    }

    function toggleAnimation() {
        if (state.animationInterval) {
            stopAnimation();
        } else {
            animateBtn.textContent = "Stop";
            animateBtn.classList.add('danger-button');
            state.animationInterval = setInterval(() => {
                if (!performStep()) {
                    stopAnimation();
                }
            }, 600);
        }
    }
    
    function stopAnimation() {
        clearInterval(state.animationInterval);
        state.animationInterval = null;
        animateBtn.textContent = "Animate";
        animateBtn.classList.remove('danger-button');
    }

    // --- RENDERING & PLOTTING ---
    function updateButtons() {
        startBtn.disabled = state.isRunning;
        stepBtn.disabled = !state.isRunning;
        animateBtn.disabled = !state.isRunning;
        resetBtn.disabled = !state.isRunning && state.iteration === 0;
    }
    
    function renderLog() {
        logTableBody.innerHTML = '';
        state.log.forEach(row => {
            const tr = logTableBody.insertRow(0); // Insert at top
            tr.innerHTML = `
                <td>${row.iter}</td>
                <td>${row.a.toFixed(5)}</td>
                <td>${row.b.toFixed(5)}</td>
                <td>${row.m.toFixed(5)}</td>
                <td>${row.fm.toExponential(3)}</td>
                <td>${row.width.toExponential(3)}</td>
            `;
        });
    }

    function plotFunction() {
        const funcData = FUNCTIONS[functionSelect.value];
        const range = funcData.range;
        const xValues = [];
        const yValues = [];
        const stepSize = (range[1] - range[0]) / 400;

        for (let x = range[0]; x <= range[1]; x += stepSize) {
            xValues.push(x);
            yValues.push(funcData.fn(x));
        }
        
        const layout = {
            title: `Plot of f(x) = ${functionSelect.value}`,
            xaxis: { title: 'x', gridcolor: '#e0e0e0', zerolinecolor: '#9e9e9e' },
            yaxis: { title: 'f(x)', gridcolor: '#e0e0e0', zerolinecolor: '#9e9e9e' },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: '#ffffff',
            margin: { l: 50, r: 25, t: 40, b: 40 },
            shapes: []
        };

        Plotly.newPlot(plotContainer, [{ x: xValues, y: yValues, mode: 'lines', line: { color: 'royalblue' } }], layout, {responsive: true, displaylogo: false});
    }
    
    function updatePlotAnnotations() {
        const shapes = [
            // Highlighted interval region
            {
                type: 'rect', layer: 'below',
                xref: 'x', yref: 'paper',
                x0: state.a, y0: 0,
                x1: state.b, y1: 1,
                fillcolor: 'rgba(21, 101, 192, 0.1)',
                line: { width: 0 }
            },
            // Midpoint line
            {
                type: 'line', layer: 'above',
                xref: 'x', yref: 'paper',
                x0: state.m, y0: 0,
                x1: state.m, y1: 1,
                line: { color: 'crimson', width: 2, dash: 'dot' }
            }
        ];
        Plotly.relayout(plotContainer, { shapes: shapes });
    }
    
    initialize();
});
</script>
</body>
</html>
