<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Function Builder & Analyzer</title>
  <style>
    :root {
      --primary-color: #1565c0;
      --secondary-color: #2e7d32;
      --danger-color: #d32f2f;
      --light-gray: #f5f5f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #424242;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6;background:var(--light-gray);color:var(--dark-gray);display:flex;justify-content:center;padding:1rem}
    .container{width:100%;max-width:1000px;background:#fff;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.1);padding:1.5rem}
    h2{font-size:1.9rem;color:var(--primary-color);margin-bottom:.5rem;font-weight:700}
    p.info{color:#616161;margin-bottom:1.5rem}
    .main-layout{display:grid;grid-template-columns:280px 1fr;gap:1.5rem}
    @media(max-width:800px){.main-layout{grid-template-columns:1fr}}
    .controls-panel{display:flex;flex-direction:column;gap:1rem}
    .control-group{display:flex;flex-direction:column;gap:.75rem;padding:1rem;background:var(--light-gray);border-radius:6px}
    label{font-size:.9rem;font-weight:600;color:#616161;text-align:left}
    select,button{border:1px solid var(--medium-gray);border-radius:4px;padding:10px;font-size:1rem;cursor:pointer;background:#fff;transition:.15s}
    button:hover:not(:disabled),select:hover:not(:disabled){background:#e3f2fd}
    button.tool-btn.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color);font-weight:600}
    button:disabled{cursor:not-allowed;background:#eee;color:#aaa}
    .danger-button{background:var(--danger-color);color:#fff}
    .danger-button:hover:not(:disabled){background:#c62828}
    .secondary-button{background:var(--secondary-color);color:#fff}
    .secondary-button:hover:not(:disabled){background:#1b5e20}
    .piece-library{display:flex;gap:6px;flex-wrap:wrap}
    .canvas-wrapper{position:relative;width:100%;aspect-ratio:1/1;user-select:none}
    canvas{position:absolute;top:0;left:0;width:100%;height:100%}
    #grid-canvas{background:#fff;border:1px solid var(--medium-gray);border-radius:4px;z-index:1}
    #main-canvas{z-index:5;cursor:crosshair}
    #main-canvas.locked{cursor:not-allowed}
    #analysis-results{margin-top:1rem;padding:1rem;background:var(--light-gray);border-radius:4px;font-size:.95rem;line-height:1.7;white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;min-height:140px}
  </style>
</head>
<body>
<div class="container">
<h2>Interactive Function Builder</h2>
<p class="info">Build a piece‑wise function, then click <strong>Analyze Graph</strong> for a full report (domain, range, monotonicity, concavity, etc.).</p>
<div class="main-layout">
  <div class="controls-panel">
    <div class="control-group">
      <label>1. Build a Function</label>
      <select id="example-select"><option value="">-- Start with Example --</option></select>
      <div class="piece-library" style="margin-top:.5rem">
        <button class="tool-btn" data-tool="line">Draw Line</button>
        <button class="tool-btn" data-tool="curve">Draw Curve</button>
      </div>
      <button id="clear-btn" class="danger-button" style="margin-top:.5rem">Clear Drawing</button>
    </div>
    <div class="control-group">
      <label>2. Analyze the Graph</label>
      <button id="analyze-btn" class="secondary-button">Analyze Graph</button>
    </div>
    <div id="analysis-results">Draw or load an example, then analyze…</div>
  </div>
  <div class="canvas-wrapper">
    <canvas id="grid-canvas"></canvas>
    <canvas id="main-canvas"></canvas>
  </div>
</div>
</div>
<script>
/********************  GLOBAL CONSTANTS  ********************/
const WORLD_MIN=-10,WORLD_MAX=10,SAMPLE_PTS=120,TOL_X=0.025,TOL_Y=0.05;
/********************  UTILITIES  ***************************/
const U={
  toScreen:(p,cv)=>({x:(p.x-WORLD_MIN)/(WORLD_MAX-WORLD_MIN)*cv.width,y:(WORLD_MAX-p.y)/(WORLD_MAX-WORLD_MIN)*cv.height}),
  fromScreen:(c,cv)=>({x:WORLD_MIN+c.x/cv.width*(WORLD_MAX-WORLD_MIN),y:WORLD_MAX-c.y/cv.height*(WORLD_MAX-WORLD_MIN)}),
  dist:(a,b)=>Math.hypot(a.x-b.x,a.y-b.y),
  snap:(p,pieces,thr=0.3)=>{for(const pe of pieces){for(const ep of[pe.p1,pe.p2])if(U.dist(p,ep)<thr)return ep;}return p;},
  bez:(a,b,c,t)=>(1-t)*(1-t)*a+2*(1-t)*t*b+t*t*c
};
/********************  STATE  *******************************/
const state={tool:'line',placing:'idle',pStart:null,pieces:[],locked:false,analysis:null};
/********************  CANVAS SETUP  ************************/
const gridCv=document.getElementById('grid-canvas'),mainCv=document.getElementById('main-canvas');
const gCtx=gridCv.getContext('2d'),mCtx=mainCv.getContext('2d');
function resize(){const sz=gridCv.parentElement.getBoundingClientRect().width,dpr=window.devicePixelRatio||1;[gridCv,mainCv].forEach(cv=>{cv.style.width=cv.style.height=sz+'px';cv.width=cv.height=sz*dpr;cv.getContext('2d').scale(dpr,dpr);});drawAll();}
window.addEventListener('resize',resize);resize();
/********************  DRAW GRID  ***************************/
function drawGrid(){const w=gridCv.width/(devicePixelRatio||1),h=gridCv.height/(devicePixelRatio||1);gCtx.clearRect(0,0,w,h);gCtx.lineWidth=1;gCtx.strokeStyle='#f0f0f0';for(let i=-9;i<=9;i++){const xs=U.toScreen({x:i,y:0},gridCv).x,ys=U.toScreen({x:0,y:i},gridCv).y;gCtx.beginPath();gCtx.moveTo(xs,0);gCtx.lineTo(xs,h);gCtx.stroke();gCtx.beginPath();gCtx.moveTo(0,ys);gCtx.lineTo(w,ys);gCtx.stroke();}gCtx.lineWidth=2;gCtx.strokeStyle='#bdbdbd';const xAx=U.toScreen({x:0,y:0},gridCv).y,yAx=U.toScreen({x:0,y:0},gridCv).x;gCtx.beginPath();gCtx.moveTo(0,xAx);gCtx.lineTo(w,xAx);gCtx.stroke();gCtx.beginPath();gCtx.moveTo(yAx,0);gCtx.lineTo(yAx,h);gCtx.stroke();}
/********************  DRAW PIECES  *************************/
function drawEndpoint(p,closed){const {x,y}=U.toScreen(p,mainCv);mCtx.fillStyle=closed?'var(--primary-color)':'#fff';mCtx.strokeStyle='var(--primary-color)';mCtx.lineWidth=2;mCtx.beginPath();mCtx.arc(x,y,5,0,Math.PI*2);mCtx.fill();mCtx.stroke();}
function drawPiece(pe){mCtx.strokeStyle='var(--primary-color)';mCtx.lineWidth=3;mCtx.lineCap='round';mCtx.beginPath();const s=U.toScreen(pe.p1,mainCv),e=U.toScreen(pe.p2,mainCv);mCtx.moveTo(s.x,s.y);if(pe.type==='line')mCtx.lineTo(e.x,e.y);else{const c=U.toScreen(pe.cp,mainCv);mCtx.quadraticCurveTo(c.x,c.y,e.x,e.y);}mCtx.stroke();drawEndpoint(pe.p1,pe.startType==='closed');drawEndpoint(pe.p2,pe.endType==='closed');}
function drawAll(){drawGrid();mCtx.clearRect(0,0,mainCv.width,mainCv.height);state.pieces.forEach(drawPiece);if(state.analysis&&!state.analysis.isFunc){mCtx.strokeStyle='var(--danger-color)';mCtx.lineWidth=2;const sx=U.toScreen({x:state.analysis.failX,y:0},mainCv).x;mCtx.beginPath();mCtx.moveTo(sx,0);mCtx.lineTo(sx,mainCv.height);mCtx.stroke();}}
/********************  EVENT HANDLERS  **********************/
mainCv.addEventListener('mousedown',e=>{if(state.locked)return;const rect=mainCv.getBoundingClientRect(),p=U.fromScreen({x:(e.clientX-rect.left)*(devicePixelRatio||1),y:(e.clientY-rect.top)*(devicePixelRatio||1)},mainCv);if(state.placing==='idle'){state.placing='placing';state.pStart=U.snap(p,state.pieces);}else{const p2=U.snap(p,state.pieces);if(U.dist(p2,state.pStart)<0.05){state.placing='idle';state.pStart=null;drawAll();return;}state.pieces.push(makePiece(state.tool,state.pStart,p2));state.placing='idle';state.pStart=null;drawAll();}});
mainCv.addEventListener('mousemove',e=>{if(state.placing!=='placing'||state.locked)return;drawAll();const rect=mainCv.getBoundingClientRect(),p=U.fromScreen({x:(e.clientX-rect.left)*(devicePixelRatio||1),y:(e.clientY-rect.top)*(devicePixelRatio||1)},mainCv);drawPiece(makePiece(state.tool,state.pStart,p));});
function makePiece(type,p1,p2){const obj={type,p1,p2,startType:'closed',endType:'closed'};if(type==='curve'){const mid={x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2},dx=p2.x-p1.x,dy=p2.y-p1.y;obj.cp={x:mid.x-dy*0.5,y:mid.y+dx*0.5};}return obj;}
/********************  ANALYSIS  ***************************/
function samplePiece(pe){const pts=[];const n=SAMPLE_PTS;for(let i=0;i<=n;i++){const t=i/n;if(pe.type==='line'){pts.push({x:pe.p1.x+t*(pe.p2.x-pe.p1.x),y:pe.p1.y+t*(pe.p2.y-pe.p1.y)});}else{pts.push({x:U.bez(pe.p1.x,pe.cp.x,pe.p2.x,t),y:U.bez(pe.p1.y,pe.cp.y,pe.p2.y,t)});} }return pts;}
function analyze(){if(!state.pieces.length)return null;let samples=[];state.pieces.forEach(pe=>samples=samples.concat(samplePiece(pe)));samples.sort((a,b)=>a.x-b.x);
// vertical line test
let isFunc=true,failX=null;for(let i=0;i<samples.length;i++){const x0=samples[i].x;const bucket=samples.filter(pt=>Math.abs(pt.x-x0)<TOL_X);const ys=[...new Set(bucket.map(pt=>pt.y.toFixed(3)))];if(ys.length>1){isFunc=false;failX=x0;break;}}
// domain & range
const xs=samples.map(p=>p.x),ys=samples.map(p=>p.y);const domain=[Math.min(...xs),Math.max(...xs)],range=[Math.min(...ys),Math.max(...ys)];
// first derivative
const slopes=samples.map((p,i)=>i>0?(p.y-samples[i-1].y)/(p.x-samples[i-1].x):null).slice(1);
const second=slopes.map((s,i)=>i>0?(s-slopes[i-1])/(samples[i+1].x-samples[i].x):null).slice(1);
function classify(arr,labels,threshold){const intervals={};labels.forEach(l=>intervals[l]=[]);let curLabel=null,start=xs[0];for(let i=0;i<arr.length;i++){const val=arr[i];let lbl='const';if(val>threshold)lbl='inc';else if(val<-threshold)lbl='dec';if(curLabel===null)curLabel=lbl;else if(lbl!==curLabel){intervals[curLabel].push([start,samples[i].x]);curLabel=lbl;start=samples[i].x;}}intervals[curLabel].push([start,xs[xs.length-1]]);return intervals;}
const mono=classify(slopes,['inc','dec','const'],0.03);
function classify2(arr,threshold){const res={up:[],down:[],linear:[]};let cur=null,start=samples[1].x;for(let i=0;i<arr.length;i++){const v=arr[i];let label='linear';if(v>threshold)label='up';else if(v<-threshold)label='down';if(cur===null)cur=label;else if(cur!==label){res[cur].push([start,samples[i+1].x]);cur=label;start=samples[i+1].x;}}res[cur].push([start,xs[xs.length-1]]);return res;}
const conc=classify2(second,0.02);
function fmt(intervals){return intervals.map(r=>`(${r[0].toFixed(2)}, ${r[1].toFixed(2)})`).join(' ∪ ');} // open intervals
return{isFunc,failX,domain:`[${domain[0].toFixed(2)}, ${domain[1].toFixed(2)}]`,range:`[${range[0].toFixed(2)}, ${range[1].toFixed(2)}]`,inc:fmt(mono.inc),dec:fmt(mono.dec),constI:fmt(mono.const),cup:fmt(conc.up),cdown:fmt(conc.down)};}
function buildReport(r){if(!r)return'Please draw something first.';let txt=`Is it a function?  : ${r.isFunc?'Yes ✅':`No ❌ (fails near x≈${r.failX.toFixed(2)})`}\nDomain            : ${r.domain}\nRange             : ${r.range}`;if(r.isFunc){txt+=`\nIncreasing on     : ${r.inc||'—'}\nDecreasing on     : ${r.dec||'—'}\nConstant on       : ${r.constI||'—'}\nConcave up on     : ${r.cup||'—'}\nConcave down on   : ${r.cdown||'—'}`;}return txt;}
/********************  UI CONTROLS  ************************/
function updatePanel(t){document.getElementById('analysis-results').textContent=t;}
document.querySelectorAll('.tool-btn').forEach(b=>b.onclick=()=>{state.tool=b.dataset.tool;document.querySelectorAll('.tool-btn').forEach(bb=>bb.classList.remove('active'));b.classList.add('active');});
 document.getElementById('clear-btn').onclick=()=>{Object.assign(state,{pieces:[],analysis:null,locked:false});mainCv.classList.remove('locked');document.getElementById('example-select').value='';drawAll();updatePanel('Canvas cleared.');};
 document.getElementById('analyze-btn').onclick=()=>{state.analysis=analyze();drawAll();updatePanel(buildReport(state.analysis));};
/********************  EXAMPLES  ***************************/
const EXAMPLES={wave:[{type:'curve',p1:{x:-8,y:0},p2:{x:0,y:0},cp:{x:-4,y:6},startType:'closed',endType:'closed'},{type:'curve',p1:{x:0,y:0},p2:{x:8,y:0},cp:{x:4,y:-6},startType:'closed',endType:'closed'}],v_shape:[{type:'line',p1:{x:-5,y:5},p2:{x:0,y:-5},startType:'closed',endType:'closed'},{type:'line',p1:{x:0,y:-5},p2:{x:5,y:5},startType:'closed',endType:'closed'}],step_func:[{type:'line',p1:{x:-6,y:3},p2:{x:0,y:3},startType:'closed',endType:'open'},{type:'line',p1:{x:0,y:-2},p2:{x:6,y:-2},startType:'open',endType:'closed'}],vertical_line:[{type:'line',p1:{x:2,y:-4},p2:{x:2,y:4},startType:'closed',endType:'closed'}]};
const names={wave:'Simple Wave',v_shape:'V‑Shape',step_func:'Step Function (valid)',vertical_line:'Vertical Line (invalid)'};const sel=document.getElementById('example-select');Object.entries(names).forEach(([k,v])=>{const o=document.createElement('option');o.value=k;o.textContent=v;sel.appendChild(o);});sel.onchange=e=>{const v=e.target.value;if(!v)return;state.pieces=JSON.parse(JSON.stringify(EXAMPLES[v]));state.locked=true;mainCv.classList.add('locked');state.analysis=analyze();drawAll();updatePanel(buildReport(state.analysis));};
/********************  INIT  ******************************/
drawAll();document.querySelector("button[data-tool='line']").classList.add('active');
</script>
</body>
</html>
